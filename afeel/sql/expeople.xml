<?xml version="1.0" encoding="UTF-8" ?>
<query>
    <myquery id="endMatchList">
        SELECT endmatchlist.memberNo, p.profilThumbnail AS profilThumbnail, endmatchlist.memberName, endmatchlist.memberBirth, endmatchlist.memberHobby, endmatchlist.memberAdd, endmatchlist.memberHeight, endmatchlist.memberJob, endmatchlist.memberSnsYn, endmatchlist.memberHPYn, endmatchlist.memberEmailYn, endmatchlist.chatroomNo, endmatchlist.rank, endmatchlist.chatroomRegDate, (select fType FROM FEELING_TYPE WHERE fTypeNo = 1) AS ftypeNo1 , (select fType FROM FEELING_TYPE WHERE fTypeNo = 2) AS fTypeNo2 , (select fType FROM FEELING_TYPE WHERE fTypeNo = 3) AS fTypeNo3
        FROM
        (
            SELECT m.memberName AS memberName, m.memberBirth AS memberBirth, m.memberHobby AS memberHobby , m.memberAdd AS memberAdd, m.memberHeight AS memberHeight, chat.partnerGender AS partnerGender,
            m.memberJob AS memberJob , m.memberSnsYn AS memberSnsYn , m.memberHPYn AS memberHPYn, m.memberEmailYn AS memberEmailYn, chat.chatroomNo AS chatroomNo, chat.rank AS rank, chat.chatroomRegDate AS chatroomRegDate, m.memberNo AS memberNo
            FROM
            (
                SELECT  croom.chatroomNo AS chatroomNo, croom.chatroomRegDate AS chatroomRegDate, crank.rank AS rank, crank.memberNo AS memberNo,  IF((select memberGender FROM MEMBER where memberNo=?) = 'M' , 'W' , 'M') as partnerGender FROM CHAT_RANK crank LEFT OUTER JOIN CHATROOM croom
                ON croom.chatroomNo = crank.chatroomNo WHERE crank.rank = IF((select memberGender FROM MEMBER where memberNo = ?) = 'M', 0, 1 )
            ) chat JOIN MEMBER m ON chat.memberNo = m.memberNo
        ) endmatchlist JOIN PROFIL p ON endmatchlist.memberNo = p.memberNo
    </myquery>


</query>


