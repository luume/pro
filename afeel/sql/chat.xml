<?xml version="1.0" encoding="UTF-8" ?>
<query>
    <myquery id="privateChatList">
        select PRIVATE_ROOM.memberWNo, PRIVATE_ROOM.memberMNo, PRIVATE_MESSAGE.messageFrom,
        PRIVATE_MESSAGE.messageTo, PRIVATE_MESSAGE.messageData, PRIVATE_MESSAGE.messageDate
        from PRIVATE_MESSAGE inner join PRIVATE_ROOM
        where PRIVATE_ROOM.privateRoomNo = PRIVATE_MESSAGE.privateRoomNo and PRIVATE_ROOM.privateRoomNo = ?
    </myquery>
    <myquery id="showVoiceAnswerList">
    SELECT VOICE_ANSWER.voiceAnswerOriginalFileName, QUESTION.questionData from QUESTION inner join
    VOICE_ANSWER on QUESTION.questionNo = VOICE_ANSWER.questionNo where VOICE_ANSWER.chatroomNo = ?
    </myquery>
    <myquery id="showTextAnswerList">
        SELECT TEXT_ANSWER.textAnswerData, QUESTION.questionData from QUESTION inner join
        TEXT_ANSWER on QUESTION.questionNo = TEXT_ANSWER.questionNo where TEXT_ANSWER.chatroomNo = ?
    </myquery>

    <myquery id="chatForthList">
        select MEMBER.memberNick, MEMBER.memberGender, MEMBER.memberJob, MEMBER.memberHobby,
        MEMBER.memberAdd, MEMBER.memberBirth, MEMBER.memberHeight, MEMBER.memberEmailYn, MEMBER.memberSNSYn,
        CONCAT((select fType FROM FEELING_TYPE WHERE fTypeNo = ?), ',', (select fType FROM FEELING_TYPE WHERE fTypeNo = ?) , ',' , (select fType FROM FEELING_TYPE WHERE fTypeNo = ?)) as fType
        from MEMBER
        where MEMBER.memberNo=?
    </myquery>

    <myquery id="chatMain">
        SELECT p.profilThumbnail
        FROM CHATROOM c, PROFIL p
        WHERE c.memberWNo = p.memberNo
        AND p.profilMainYn = 1
        AND c.chatroomRegDate > DATE_ADD(now(), INTERVAL -1 day) ORDER BY RAND() LIMIT 0,5
    </myquery>

    <myquery id="createPrivateChat">
        INSERT INTO PRIVATE_ROOM(memberWNo, memberMNo, privateRoomRegDate) VALUES(?,?,NOW())
    </myquery>

    <myquery id="viewPrivateChat">
        SELECT isMe, messageFrom, messageTo, messageData, messageDate, (IF(isMe=0 , (select memberName FROM MEMBER WHERE memberNo = ?) , (select memberName FROM MEMBER WHERE memberNo = ?))) AS memberName FROM (
        select
        case messageFrom
        when ? then 1
        else 0
        end as isMe, messageFrom, messageTo, messageData, messageDate
        from PRIVATE_MESSAGE where privateRoomNo = ? order by messageDate asc )a
    </myquery>
    <myquery id="chatRoomHide">
        update CHATROOM set isHide=isHide+1 WHERE chatroomNo=?
    </myquery>

    <myquery id="insertPrivateMessage">
        INSERT INTO PRIVATE_MESSAGE(messageNo, privateRoomNo, messageFrom, messageTO, messageData) VALUES(0, ?, ?, ?, ?)
    </myquery>

    <myquery id="firstChatView">
        SELECT memberNo, profilThumbnail
        FROM PROFIL
        WHERE memberNo IN (
        (select memberM1No from CHATROOM where chatroomNo = ?),
        (select memberM2No from CHATROOM where chatroomNo = ?),
        (select memberM3No from CHATROOM where chatroomNo = ?),
        (select memberM4No from CHATROOM where chatroomNo = ?)
        ) and PROFIL.profilMainYn
    </myquery>
</query>
